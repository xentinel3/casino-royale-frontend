<div class="mb-8 flex flex-wrap items-center justify-between gap-4">
  <h1 class="text-2xl font-semibold text-[var(--ui-ux-5)]">Eventos</h1>
  <div class="flex items-center gap-2">
    <button class="btn btn-sm btn-ghost" (click)="openCreateEvent()" aria-label="Crear evento">
      <lucide-icon [img]="plusIcon" class="h-4 w-4"></lucide-icon>
    </button>
    <button class="btn btn-sm btn-ghost" (click)="loadEvents()" aria-label="Actualizar eventos">
      <lucide-icon [img]="refreshIcon" class="h-4 w-4"></lucide-icon>
    </button>
  </div>
</div>

<section class="mt-6 rounded-2xl border border-[color:var(--ui-ux-1)] border-opacity-10 bg-white/70 p-6 shadow-sm">
  <p class="text-sm text-[var(--ui-ux-1)]">{{ eventStatus }}</p>
  <p class="mt-2 text-xs text-[var(--ui-ux-1)]" *ngIf="competitorsStatus">{{ competitorsStatus }}</p>
  <div
    class="mt-4 rounded-2xl border border-[color:var(--ui-ux-1)] border-opacity-10 bg-white/80 p-4"
    *ngIf="editingEventId"
  >
    <h3 class="text-base font-semibold text-[var(--ui-ux-5)]">Editar evento</h3>
    <div class="mt-4 grid gap-4 sm:grid-cols-2">
      <div class="grid gap-2">
        <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Inicio</label>
        <input
          name="editEventStart"
          [(ngModel)]="editEventForm.startTime"
          type="datetime-local"
          class="input input-bordered bg-transparent"
        />
      </div>
      <div class="grid gap-2">
        <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Temporada</label>
          <select
            name="editEventSeason"
            [(ngModel)]="editEventForm.seasonId"
            class="select select-bordered bg-transparent"
          >
            <option value="">Selecciona temporada</option>
            <option *ngFor="let season of seasons" [value]="season.id">
              {{ season.name }}
              <ng-container *ngIf="season.start_date || season.end_date">
                ({{ season.start_date ? (season.start_date | date: 'yyyy-MM-dd') : 'N/A' }} -
              {{ season.end_date ? (season.end_date | date: 'yyyy-MM-dd') : 'N/A' }})
            </ng-container>
          </option>
        </select>
      </div>
      <div class="grid gap-2">
        <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Jornada</label>
        <input
          name="editEventRound"
          [(ngModel)]="editEventForm.round"
          class="input input-bordered bg-transparent"
          placeholder="J1"
        />
      </div>
      <div class="grid gap-2">
        <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">HOME</label>
        <select
          name="editEventHome"
          [(ngModel)]="editEventForm.homeId"
          class="select select-bordered bg-transparent"
        >
          <option value="">Selecciona HOME</option>
          <option *ngFor="let competitor of competitors" [value]="competitor.id">
            {{ competitor.name }}
          </option>
        </select>
      </div>
      <div class="grid gap-2">
        <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">AWAY</label>
        <select
          name="editEventAway"
          [(ngModel)]="editEventForm.awayId"
          class="select select-bordered bg-transparent"
        >
          <option value="">Selecciona AWAY</option>
          <option *ngFor="let competitor of competitors" [value]="competitor.id">
            {{ competitor.name }}
          </option>
        </select>
      </div>
    </div>
    <div class="mt-4 flex flex-wrap gap-2">
      <button class="btn btn-primary" (click)="submitEditEvent()">Guardar</button>
      <button class="btn btn-ghost" (click)="cancelEditEvent()">Cancelar</button>
    </div>
    <p class="mt-2 text-sm text-[var(--ui-ux-1)]">{{ editEventStatus }}</p>
  </div>
  <p class="mt-2 text-sm text-[var(--ui-ux-1)]" *ngIf="isLoadingEvents">Cargando eventos...</p>
  <p class="mt-2 text-sm text-[var(--ui-ux-1)]" *ngIf="eventsStatus">{{ eventsStatus }}</p>
  <p class="mt-4 text-sm text-[var(--ui-ux-1)]" *ngIf="!isLoadingEvents && !eventsStatus && events.length === 0">
    No hay eventos dados de alta.
  </p>
  <div class="mt-4 grid gap-4" *ngIf="events.length > 0">
    <div
      class="rounded-xl border border-[color:var(--ui-ux-1)] border-opacity-10 bg-white/80 p-4"
      *ngFor="let event of events"
    >
      <div class="flex flex-wrap items-center justify-between gap-3">
        <div>
          <p class="text-xs uppercase tracking-[0.2em] text-[var(--ui-ux-1)]">Evento</p>
          <p class="text-base font-semibold text-[var(--ui-ux-5)]">
            {{ event.competitors[0].name }} vs {{ event.competitors[1].name }}
          </p>
        </div>
        <div class="text-right">
          <p class="text-xs uppercase tracking-[0.2em] text-[var(--ui-ux-1)]">Inicio</p>
          <p class="text-sm text-[var(--ui-ux-5)]">{{ event.start_time | date: 'medium' }}</p>
        </div>
      </div>
      <div class="mt-3 flex flex-wrap items-center gap-3">
        <button class="btn btn-xs btn-ghost" (click)="startEditEvent(event)">Editar</button>
        <button class="btn btn-xs btn-ghost text-red-600" (click)="deleteEvent(event)">
          Borrar
        </button>
      </div>
      <div class="mt-3 flex flex-wrap items-center gap-3 text-xs text-[var(--ui-ux-1)]">
        <span class="max-w-full break-words whitespace-normal rounded-full border border-[color:var(--ui-ux-1)] border-opacity-20 px-3 py-1">
          ID: {{ event.id }}
        </span>
        <span
          class="max-w-full break-words whitespace-normal rounded-full border border-[color:var(--ui-ux-1)] border-opacity-20 px-3 py-1"
          *ngIf="event.season_name"
        >
          Temporada: {{ event.season_name }}
        </span>
        <span
          class="max-w-full break-words whitespace-normal rounded-full border border-[color:var(--ui-ux-1)] border-opacity-20 px-3 py-1"
          *ngIf="event.round"
        >
          Jornada: {{ event.round }}
        </span>
      </div>
    </div>
  </div>
</section>

<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 px-4" *ngIf="isCreateEventOpen">
  <div class="w-full max-w-2xl rounded-2xl border border-[color:var(--ui-ux-1)] border-opacity-20 bg-white p-6 shadow-xl">
    <div class="flex items-center justify-between gap-4">
      <h2 class="text-lg font-semibold text-[var(--ui-ux-5)]">Crear evento</h2>
      <button class="btn btn-sm btn-ghost" (click)="closeCreateEvent()">Cerrar</button>
    </div>
    <form class="mt-4 grid gap-4" (ngSubmit)="submitEvent()">
      <div class="grid gap-2">
        <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Inicio</label>
        <input
          name="eventStartModal"
          [(ngModel)]="eventForm.startTime"
          type="datetime-local"
          class="input input-bordered bg-transparent"
        />
      </div>
      <div class="grid gap-4 sm:grid-cols-2">
        <div class="grid gap-2">
          <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Competidor HOME</label>
          <select
            name="homeCompetitorModal"
            [(ngModel)]="eventForm.homeId"
            class="select select-bordered bg-transparent"
          >
            <option value="">Selecciona HOME</option>
            <option *ngFor="let competitor of competitors" [value]="competitor.id">
              {{ competitor.name }}
            </option>
          </select>
        </div>
        <div class="grid gap-2">
          <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Competidor AWAY</label>
          <select
            name="awayCompetitorModal"
            [(ngModel)]="eventForm.awayId"
            class="select select-bordered bg-transparent"
          >
            <option value="">Selecciona AWAY</option>
            <option *ngFor="let competitor of competitors" [value]="competitor.id">
              {{ competitor.name }}
            </option>
          </select>
        </div>
      </div>
      <div class="grid gap-4 sm:grid-cols-2">
        <div class="grid gap-2">
          <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Season</label>
          <select
            name="seasonModal"
            [(ngModel)]="eventForm.seasonId"
            class="select select-bordered bg-transparent"
          >
            <option value="">Selecciona temporada</option>
            <option *ngFor="let season of seasons" [value]="season.id">
              {{ season.name }}
              <ng-container *ngIf="season.start_date || season.end_date">
                ({{ season.start_date ? (season.start_date | date: 'yyyy-MM-dd') : 'N/A' }} -
                {{ season.end_date ? (season.end_date | date: 'yyyy-MM-dd') : 'N/A' }})
              </ng-container>
            </option>
          </select>
        </div>
        <div class="grid gap-2">
          <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Round</label>
          <input
            name="roundModal"
            [(ngModel)]="eventForm.round"
            class="input input-bordered bg-transparent"
            placeholder="J1"
          />
        </div>
      </div>
      <button class="btn btn-primary w-full shadow-md">Crear evento</button>
      <p class="text-sm text-[var(--ui-ux-1)]">{{ eventStatus }}</p>
    </form>
  </div>
</div>
