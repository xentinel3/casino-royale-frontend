<div class="mb-8 flex flex-wrap items-center justify-between gap-4">
  <h1 class="text-2xl font-semibold text-[var(--ui-ux-5)]">Eventos</h1>
  <div class="flex items-center gap-2">
    <button class="btn btn-sm btn-ghost" (click)="openCreateEvent()" aria-label="Crear evento">
      <lucide-icon [img]="plusIcon" class="h-4 w-4"></lucide-icon>
    </button>
    <button class="btn btn-sm btn-ghost" (click)="loadEvents()" aria-label="Actualizar eventos">
      <lucide-icon [img]="refreshIcon" class="h-4 w-4"></lucide-icon>
    </button>
  </div>
</div>

<section class="mt-6 rounded-xl border border-slate-200/70 bg-white/80 p-8 shadow-[0_8px_30px_rgba(0,0,0,0.06)] ring-1 ring-black/5 backdrop-blur">
  <p class="text-sm text-[var(--ui-ux-1)]">{{ eventStatus }}</p>
  <p class="mt-2 text-xs text-[var(--ui-ux-1)]" *ngIf="competitorsStatus">{{ competitorsStatus }}</p>
  <div
    class="mt-6 rounded-xl border border-slate-200/80 bg-white p-6 shadow-[0_10px_30px_rgba(0,0,0,0.08)] ring-1 ring-black/5"
    *ngIf="editingEventId"
  >
    <div class="flex items-center justify-between gap-4">
      <h3 class="text-base font-semibold text-[var(--ui-ux-5)]">Editar evento</h3>
      <span class="text-xs text-[var(--ui-ux-1)]">Actualiza datos del partido</span>
    </div>
    <div class="mt-5 grid gap-4 sm:grid-cols-2">
      <div class="grid gap-2">
        <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Inicio</label>
        <input
          name="editEventStart"
          [(ngModel)]="editEventForm.startTime"
          type="datetime-local"
          class="input input-bordered bg-white shadow-sm focus:border-slate-400"
        />
      </div>
      <div class="grid gap-2">
        <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Temporada</label>
        <select
          name="editEventSeason"
          [(ngModel)]="editEventForm.seasonId"
          class="select select-bordered bg-white shadow-sm focus:border-slate-400"
        >
            <option value="">Selecciona temporada</option>
            <option *ngFor="let season of seasons" [value]="season.id">
              {{ season.name }}
              <ng-container *ngIf="season.start_date || season.end_date">
                ({{ season.start_date ? (season.start_date | date: 'yyyy-MM-dd') : 'N/A' }} -
              {{ season.end_date ? (season.end_date | date: 'yyyy-MM-dd') : 'N/A' }})
            </ng-container>
          </option>
        </select>
      </div>
      <div class="grid gap-2">
        <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Jornada</label>
        <input
          name="editEventRound"
          [(ngModel)]="editEventForm.round"
          class="input input-bordered bg-white shadow-sm focus:border-slate-400"
          placeholder="J1"
        />
      </div>
      <div class="grid gap-2">
        <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">HOME</label>
        <select
          name="editEventHome"
          [(ngModel)]="editEventForm.homeId"
          class="select select-bordered bg-white shadow-sm focus:border-slate-400"
        >
          <option value="">Selecciona HOME</option>
          <option *ngFor="let competitor of competitors" [value]="competitor.id">
            {{ competitor.name }}
          </option>
        </select>
      </div>
      <div class="grid gap-2">
        <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">AWAY</label>
        <select
          name="editEventAway"
          [(ngModel)]="editEventForm.awayId"
          class="select select-bordered bg-white shadow-sm focus:border-slate-400"
        >
          <option value="">Selecciona AWAY</option>
          <option *ngFor="let competitor of competitors" [value]="competitor.id">
            {{ competitor.name }}
          </option>
        </select>
      </div>
    </div>
    <div class="mt-5 flex flex-wrap gap-3">
      <button class="btn btn-primary btn-sm rounded-full px-6 shadow-sm" (click)="submitEditEvent()">Guardar</button>
      <button class="btn btn-ghost btn-sm rounded-full px-6" (click)="cancelEditEvent()">Cancelar</button>
    </div>
    <div class="mt-6 border-t border-slate-200/80 pt-5">
      <label class="flex items-center gap-2 text-sm text-[var(--ui-ux-1)]">
        <input
          type="checkbox"
          class="checkbox checkbox-sm"
          [(ngModel)]="editSnapshotForm.addSnapshot"
          name="editAddSnapshot"
        />
        Agregar snapshot 1X2
      </label>
      <div class="mt-3 grid gap-4 sm:grid-cols-2" *ngIf="editSnapshotForm.addSnapshot">
        <div class="grid gap-2">
          <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Casa de apuestas</label>
          <select
            name="editBookmakerId"
            [(ngModel)]="editSnapshotForm.bookmakerId"
            class="select select-bordered bg-white shadow-sm focus:border-slate-400"
          >
            <option value="">Selecciona casa</option>
            <option *ngFor="let bookmaker of bookmakers" [value]="bookmaker.id">
              {{ bookmaker.name }}
            </option>
          </select>
          <p class="text-xs text-[var(--ui-ux-1)]" *ngIf="bookmakersStatus">{{ bookmakersStatus }}</p>
        </div>
        <div class="grid gap-2">
          <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Momio HOME</label>
          <input
            name="editHomeOdds"
            [(ngModel)]="editSnapshotForm.homeOdds"
            type="number"
            step="0.01"
            class="input input-bordered bg-white shadow-sm focus:border-slate-400"
          />
        </div>
        <div class="grid gap-2">
          <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Momio DRAW</label>
          <input
            name="editDrawOdds"
            [(ngModel)]="editSnapshotForm.drawOdds"
            type="number"
            step="0.01"
            class="input input-bordered bg-white shadow-sm focus:border-slate-400"
          />
        </div>
        <div class="grid gap-2">
          <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Momio AWAY</label>
          <input
            name="editAwayOdds"
            [(ngModel)]="editSnapshotForm.awayOdds"
            type="number"
            step="0.01"
            class="input input-bordered bg-white shadow-sm focus:border-slate-400"
          />
        </div>
        <div class="sm:col-span-2">
          <button class="btn btn-primary btn-sm rounded-full px-6 shadow-sm" (click)="submitEditSnapshot()">Guardar snapshot</button>
        </div>
      </div>
    </div>
    <p class="mt-2 text-sm text-[var(--ui-ux-1)]">{{ editEventStatus }}</p>
  </div>
  <p class="mt-2 text-sm text-[var(--ui-ux-1)]" *ngIf="isLoadingEvents">Cargando eventos...</p>
  <p class="mt-2 text-sm text-[var(--ui-ux-1)]" *ngIf="eventsStatus">{{ eventsStatus }}</p>
  <p class="mt-4 text-sm text-[var(--ui-ux-1)]" *ngIf="!isLoadingEvents && !eventsStatus && events.length === 0">
    No hay eventos dados de alta.
  </p>
  <div class="mt-4 grid gap-4" *ngIf="events.length > 0">
    <div
      class="rounded-xl border border-slate-200/70 bg-white p-5 shadow-[0_6px_20px_rgba(0,0,0,0.05)] ring-1 ring-black/5"
      *ngFor="let event of events"
    >
      <div class="flex flex-wrap items-center justify-between gap-3">
        <div class="flex flex-wrap items-center gap-2">
          <p class="text-xs uppercase tracking-[0.2em] text-[var(--ui-ux-1)]">Evento</p>
          <p class="text-base font-semibold text-[var(--ui-ux-5)]">
            {{ event.competitors[0].name }} vs {{ event.competitors[1].name }}
          </p>
          <div class="flex items-center gap-2">
            <button class="btn btn-xs btn-ghost" (click)="startEditEvent(event)" aria-label="Editar evento">
              <lucide-icon [img]="editIcon" class="h-4 w-4"></lucide-icon>
            </button>
            <button class="btn btn-xs btn-ghost text-red-600" (click)="deleteEvent(event)" aria-label="Borrar evento">
              <lucide-icon [img]="deleteIcon" class="h-4 w-4"></lucide-icon>
            </button>
          </div>
        </div>
        <div class="text-right">
          <p class="text-xs uppercase tracking-[0.2em] text-[var(--ui-ux-1)]">Inicio</p>
          <p class="text-sm text-[var(--ui-ux-5)]">{{ event.start_time | date: 'medium' }}</p>
        </div>
      </div>
      <div class="mt-3 flex flex-wrap items-center gap-3 text-xs text-[var(--ui-ux-1)]">
        <span class="max-w-full break-words whitespace-normal rounded-full border border-[color:var(--ui-ux-1)] border-opacity-20 px-3 py-1">
          ID: {{ event.id }}
        </span>
        <span
          class="max-w-full break-words whitespace-normal rounded-full border border-[color:var(--ui-ux-1)] border-opacity-20 px-3 py-1"
          *ngIf="event.season_name"
        >
          Temporada: {{ event.season_name }}
        </span>
        <span
          class="max-w-full break-words whitespace-normal rounded-full border border-[color:var(--ui-ux-1)] border-opacity-20 px-3 py-1"
          *ngIf="event.round"
        >
          Jornada: {{ event.round }}
        </span>
      </div>
      <div
        class="mt-4 rounded-lg border border-slate-200/70 bg-slate-50/80 p-3 text-xs text-[var(--ui-ux-1)] shadow-sm ring-1 ring-black/5"
        *ngIf="event.latest_snapshot"
      >
        <div class="flex flex-wrap items-center justify-between gap-3">
          <p class="text-xs uppercase tracking-[0.2em] text-[var(--ui-ux-1)]">Snapshot</p>
          <p>{{ event.latest_snapshot.captured_at | date: 'short' }}</p>
        </div>
        <div class="mt-2 grid gap-2 sm:grid-cols-3 text-sm text-[var(--ui-ux-5)]">
          <div>
            <p class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Casa</p>
            <p>{{ event.latest_snapshot.bookmaker }}</p>
          </div>
          <div>
            <p class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Momios</p>
            <p>
              {{ event.latest_snapshot.odds['HOME'] }} /
              {{ event.latest_snapshot.odds['DRAW'] }} /
              {{ event.latest_snapshot.odds['AWAY'] }}
            </p>
          </div>
          <div>
            <p class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Mercado</p>
            <p>{{ event.latest_snapshot.market_type }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 px-4" *ngIf="isCreateEventOpen">
  <div class="w-full max-w-2xl rounded-xl border border-slate-200/70 bg-white p-6 shadow-2xl ring-1 ring-black/5">
    <div class="flex items-center justify-between gap-4">
      <h2 class="text-lg font-semibold text-[var(--ui-ux-5)]">Crear evento</h2>
      <button class="btn btn-sm btn-ghost" (click)="closeCreateEvent()">Cerrar</button>
    </div>
    <form class="mt-4 grid gap-4" (ngSubmit)="submitEvent()">
      <div class="grid gap-2">
        <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Inicio</label>
        <input
          name="eventStartModal"
          [(ngModel)]="eventForm.startTime"
          type="datetime-local"
          class="input input-bordered bg-transparent"
        />
      </div>
      <div class="grid gap-4 sm:grid-cols-2">
        <div class="grid gap-2">
          <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Competidor HOME</label>
          <select
            name="homeCompetitorModal"
            [(ngModel)]="eventForm.homeId"
            class="select select-bordered bg-transparent"
          >
            <option value="">Selecciona HOME</option>
            <option *ngFor="let competitor of competitors" [value]="competitor.id">
              {{ competitor.name }}
            </option>
          </select>
        </div>
        <div class="grid gap-2">
          <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Competidor AWAY</label>
          <select
            name="awayCompetitorModal"
            [(ngModel)]="eventForm.awayId"
            class="select select-bordered bg-transparent"
          >
            <option value="">Selecciona AWAY</option>
            <option *ngFor="let competitor of competitors" [value]="competitor.id">
              {{ competitor.name }}
            </option>
          </select>
        </div>
      </div>
      <div class="grid gap-4 sm:grid-cols-2">
        <div class="grid gap-2">
          <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Season</label>
          <select
            name="seasonModal"
            [(ngModel)]="eventForm.seasonId"
            class="select select-bordered bg-transparent"
          >
            <option value="">Selecciona temporada</option>
            <option *ngFor="let season of seasons" [value]="season.id">
              {{ season.name }}
              <ng-container *ngIf="season.start_date || season.end_date">
                ({{ season.start_date ? (season.start_date | date: 'yyyy-MM-dd') : 'N/A' }} -
                {{ season.end_date ? (season.end_date | date: 'yyyy-MM-dd') : 'N/A' }})
              </ng-container>
            </option>
          </select>
        </div>
        <div class="grid gap-2">
          <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Round</label>
          <input
            name="roundModal"
            [(ngModel)]="eventForm.round"
            class="input input-bordered bg-transparent"
            placeholder="J1"
          />
        </div>
      </div>
      <div class="grid gap-2">
        <label class="flex items-center gap-2 text-sm text-[var(--ui-ux-1)]">
          <input type="checkbox" class="checkbox checkbox-sm" [(ngModel)]="eventForm.addSnapshot" name="addSnapshot" />
          Agregar snapshot 1X2
        </label>
      </div>
      <div class="grid gap-4 sm:grid-cols-2" *ngIf="eventForm.addSnapshot">
        <div class="grid gap-2">
          <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Casa de apuestas</label>
          <select
            name="bookmakerId"
            [(ngModel)]="eventForm.bookmakerId"
            class="select select-bordered bg-transparent"
          >
            <option value="">Selecciona casa</option>
            <option *ngFor="let bookmaker of bookmakers" [value]="bookmaker.id">
              {{ bookmaker.name }}
            </option>
          </select>
          <p class="text-xs text-[var(--ui-ux-1)]" *ngIf="bookmakersStatus">{{ bookmakersStatus }}</p>
        </div>
        <div class="grid gap-2">
          <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Momio HOME</label>
          <input
            name="homeOdds"
            [(ngModel)]="eventForm.homeOdds"
            type="number"
            step="0.01"
            class="input input-bordered bg-transparent"
          />
        </div>
        <div class="grid gap-2">
          <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Momio DRAW</label>
          <input
            name="drawOdds"
            [(ngModel)]="eventForm.drawOdds"
            type="number"
            step="0.01"
            class="input input-bordered bg-transparent"
          />
        </div>
        <div class="grid gap-2">
          <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Momio AWAY</label>
          <input
            name="awayOdds"
            [(ngModel)]="eventForm.awayOdds"
            type="number"
            step="0.01"
            class="input input-bordered bg-transparent"
          />
        </div>
      </div>
      <button class="btn btn-primary w-full shadow-md">Crear evento</button>
      <p class="text-sm text-[var(--ui-ux-1)]">{{ eventStatus }}</p>
    </form>
  </div>
</div>
