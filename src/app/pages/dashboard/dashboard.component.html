<div class="min-h-screen bg-[var(--ui-ux-4)] text-[var(--ui-ux-5)]">
  <div class="border-b border-[color:var(--ui-ux-1)] border-opacity-10 bg-[var(--ui-ux-4)]">
    <div class="mx-auto flex h-16 max-w-6xl items-center justify-between px-6">
      <div class="flex items-center gap-3">
        <div class="flex h-9 w-9 items-center justify-center rounded-full border border-[color:var(--ui-ux-1)] border-opacity-15 bg-white/80">
          <lucide-icon [img]="spadeIcon" class="h-5 w-5 text-[var(--ui-ux-3)]"></lucide-icon>
        </div>
        <span class="brand-mark text-[14px] text-[var(--ui-ux-5)]">Casino Royale</span>
      </div>
      <div class="flex items-center gap-2">
        <button class="btn btn-ghost btn-sm" (click)="toggleSidebar()" aria-label="Sidebar">
          <lucide-icon
            [img]="isSidebarOpen ? sidebarCloseIcon : sidebarOpenIcon"
            class="h-5 w-5"
          ></lucide-icon>
        </button>
        <button
          class="btn btn-ghost btn-sm"
          (click)="toggleTheme()"
          aria-label="Cambiar tema"
        >
          <lucide-icon *ngIf="isDark()" [img]="moonIcon" class="h-5 w-5"></lucide-icon>
          <lucide-icon *ngIf="!isDark()" [img]="sunIcon" class="h-5 w-5"></lucide-icon>
        </button>
        <button
          class="btn btn-sm btn-ghost"
          (click)="handleLogout()"
          aria-label="Logout"
        >
          <lucide-icon [img]="logoutIcon" class="h-5 w-5"></lucide-icon>
        </button>
      </div>
    </div>
  </div>

  <main class="mx-auto max-w-6xl px-6 py-10 pr-16 sm:pr-80">
    <div class="mb-8">
      <p class="text-xs uppercase tracking-[0.2em] text-[var(--ui-ux-1)]">Fase 0</p>
      <h1 class="text-2xl font-semibold text-[var(--ui-ux-5)]">Herramientas core</h1>
      <p class="mt-2 text-sm text-[var(--ui-ux-1)]">
        Crea evento, captura momios 1X2, carga prediccion dummy y ejecuta recomendacion.
      </p>
    </div>

    <div class="grid gap-6 lg:grid-cols-2">
      <section class="rounded-2xl border border-[color:var(--ui-ux-1)] border-opacity-10 bg-white/70 p-6 shadow-sm">
        <h2 class="text-lg font-semibold text-[var(--ui-ux-5)]">1. Evento + competidores</h2>
        <form class="mt-4 grid gap-4" (ngSubmit)="submitEvent()">
          <div class="grid gap-2">
            <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Evento ID (opcional)</label>
            <input
              name="eventId"
              [(ngModel)]="eventForm.id"
              class="input input-bordered bg-transparent"
              placeholder="UUID"
            />
          </div>
          <div class="grid gap-2">
            <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Inicio</label>
            <input
              name="eventStart"
              [(ngModel)]="eventForm.startTime"
              type="datetime-local"
              class="input input-bordered bg-transparent"
            />
          </div>
          <div class="grid gap-4 sm:grid-cols-2">
            <div class="grid gap-2">
              <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Competidor HOME</label>
              <input
                name="homeName"
                [(ngModel)]="eventForm.homeName"
                class="input input-bordered bg-transparent"
                placeholder="Equipo A"
                required
              />
            </div>
            <div class="grid gap-2">
              <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Competidor AWAY</label>
              <input
                name="awayName"
                [(ngModel)]="eventForm.awayName"
                class="input input-bordered bg-transparent"
                placeholder="Equipo B"
                required
              />
            </div>
          </div>
          <div class="grid gap-4 sm:grid-cols-2">
            <div class="grid gap-2">
              <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Season</label>
              <input
                name="season"
                [(ngModel)]="eventForm.season"
                class="input input-bordered bg-transparent"
                placeholder="2024-25"
              />
            </div>
            <div class="grid gap-2">
              <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Round</label>
              <input
                name="round"
                [(ngModel)]="eventForm.round"
                class="input input-bordered bg-transparent"
                placeholder="J1"
              />
            </div>
          </div>
          <button class="btn btn-primary w-full shadow-md">Crear evento</button>
          <p class="text-sm text-[var(--ui-ux-1)]">{{ eventStatus }}</p>
        </form>
      </section>

      <section class="rounded-2xl border border-[color:var(--ui-ux-1)] border-opacity-10 bg-white/70 p-6 shadow-sm">
        <h2 class="text-lg font-semibold text-[var(--ui-ux-5)]">2. Snapshot de momios 1X2</h2>
        <form class="mt-4 grid gap-4" (ngSubmit)="submitSnapshot()">
          <div class="grid gap-2">
            <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Snapshot ID (opcional)</label>
            <input
              name="snapshotId"
              [(ngModel)]="snapshotForm.id"
              class="input input-bordered bg-transparent"
              placeholder="UUID"
            />
          </div>
          <div class="grid gap-2">
            <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Evento ID</label>
            <input
              name="snapshotEvent"
              [(ngModel)]="snapshotForm.eventId"
              class="input input-bordered bg-transparent"
              placeholder="UUID del evento"
              required
            />
          </div>
          <div class="grid gap-2">
            <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Bookmaker</label>
            <input
              name="bookmaker"
              [(ngModel)]="snapshotForm.bookmaker"
              class="input input-bordered bg-transparent"
              placeholder="dummy"
              required
            />
          </div>
          <div class="grid gap-2">
            <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Captura</label>
            <input
              name="capturedAt"
              [(ngModel)]="snapshotForm.capturedAt"
              type="datetime-local"
              class="input input-bordered bg-transparent"
            />
          </div>
          <div class="grid gap-4 sm:grid-cols-3">
            <div class="grid gap-2">
              <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">HOME</label>
              <input
                name="homeOdds"
                [(ngModel)]="snapshotForm.homeOdds"
                type="number"
                step="0.01"
                class="input input-bordered bg-transparent"
              />
            </div>
            <div class="grid gap-2">
              <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">DRAW</label>
              <input
                name="drawOdds"
                [(ngModel)]="snapshotForm.drawOdds"
                type="number"
                step="0.01"
                class="input input-bordered bg-transparent"
              />
            </div>
            <div class="grid gap-2">
              <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">AWAY</label>
              <input
                name="awayOdds"
                [(ngModel)]="snapshotForm.awayOdds"
                type="number"
                step="0.01"
                class="input input-bordered bg-transparent"
              />
            </div>
          </div>
          <button class="btn btn-primary w-full shadow-md">Crear snapshot</button>
          <p class="text-sm text-[var(--ui-ux-1)]">{{ snapshotStatus }}</p>
        </form>
      </section>

      <section class="rounded-2xl border border-[color:var(--ui-ux-1)] border-opacity-10 bg-white/70 p-6 shadow-sm">
        <h2 class="text-lg font-semibold text-[var(--ui-ux-5)]">3. Prediccion dummy</h2>
        <form class="mt-4 grid gap-4" (ngSubmit)="submitPrediction()">
          <div class="grid gap-2">
            <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Prediccion ID (opcional)</label>
            <input
              name="predictionId"
              [(ngModel)]="predictionForm.id"
              class="input input-bordered bg-transparent"
              placeholder="UUID"
            />
          </div>
          <div class="grid gap-2">
            <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Evento ID</label>
            <input
              name="predictionEvent"
              [(ngModel)]="predictionForm.eventId"
              class="input input-bordered bg-transparent"
              placeholder="UUID del evento"
              required
            />
          </div>
          <div class="grid gap-2">
            <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Modelo</label>
            <input
              name="modelVersion"
              [(ngModel)]="predictionForm.modelVersion"
              class="input input-bordered bg-transparent"
              placeholder="dummy"
            />
          </div>
          <div class="grid gap-2">
            <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Created at</label>
            <input
              name="predictionCreated"
              [(ngModel)]="predictionForm.createdAt"
              type="datetime-local"
              class="input input-bordered bg-transparent"
            />
          </div>
          <div class="grid gap-4 sm:grid-cols-3">
            <div class="grid gap-2">
              <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">P HOME</label>
              <input
                name="homeProb"
                [(ngModel)]="predictionForm.homeProb"
                type="number"
                step="0.01"
                class="input input-bordered bg-transparent"
              />
            </div>
            <div class="grid gap-2">
              <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">P DRAW</label>
              <input
                name="drawProb"
                [(ngModel)]="predictionForm.drawProb"
                type="number"
                step="0.01"
                class="input input-bordered bg-transparent"
              />
            </div>
            <div class="grid gap-2">
              <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">P AWAY</label>
              <input
                name="awayProb"
                [(ngModel)]="predictionForm.awayProb"
                type="number"
                step="0.01"
                class="input input-bordered bg-transparent"
              />
            </div>
          </div>
          <div class="grid gap-2">
            <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Rating diff</label>
            <input
              name="ratingDiff"
              [(ngModel)]="predictionForm.ratingDiff"
              type="number"
              step="0.01"
              class="input input-bordered bg-transparent"
            />
          </div>
          <button class="btn btn-primary w-full shadow-md">Crear prediccion</button>
          <p class="text-sm text-[var(--ui-ux-1)]">{{ predictionStatus }}</p>
        </form>
      </section>

      <section class="rounded-2xl border border-[color:var(--ui-ux-1)] border-opacity-10 bg-white/70 p-6 shadow-sm">
        <h2 class="text-lg font-semibold text-[var(--ui-ux-5)]">4. Ejecutar recomendacion</h2>
        <form class="mt-4 grid gap-4" (ngSubmit)="submitRecommendation()">
          <div class="grid gap-2">
            <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Evento ID</label>
            <input
              name="runEvent"
              [(ngModel)]="runForm.eventId"
              class="input input-bordered bg-transparent"
              placeholder="UUID del evento"
              required
            />
          </div>
          <div class="grid gap-2">
            <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Snapshot ID</label>
            <input
              name="runSnapshot"
              [(ngModel)]="runForm.snapshotId"
              class="input input-bordered bg-transparent"
              placeholder="UUID del snapshot"
              required
            />
          </div>
          <div class="grid gap-2">
            <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Prediction ID</label>
            <input
              name="runPrediction"
              [(ngModel)]="runForm.predictionId"
              class="input input-bordered bg-transparent"
              placeholder="UUID de prediccion"
              required
            />
          </div>
          <div class="grid gap-2">
            <label class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Bankroll</label>
            <input
              name="bankroll"
              [(ngModel)]="runForm.bankroll"
              type="number"
              step="1"
              class="input input-bordered bg-transparent"
            />
          </div>
          <button class="btn btn-primary w-full shadow-md">Generar recomendacion</button>
          <p class="text-sm text-[var(--ui-ux-1)]">{{ recommendationStatus }}</p>
        </form>

        <div *ngIf="latestRecommendation" class="mt-6 rounded-xl border border-[color:var(--ui-ux-1)] border-opacity-15 bg-white/80 p-4">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Decision</p>
              <p class="text-lg font-semibold text-[var(--ui-ux-5)]">
                {{ latestRecommendation.explanation.human_summary.decision }}
              </p>
            </div>
            <div class="text-right">
              <p class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Riesgo</p>
              <p class="text-sm font-semibold text-[var(--ui-ux-5)]">
                {{ latestRecommendation.explanation.human_summary.risk }}
              </p>
            </div>
          </div>
          <p class="mt-3 text-sm text-[var(--ui-ux-1)]">
            {{ latestRecommendation.explanation.human_summary.reason }}
          </p>
          <div class="mt-4 grid gap-3 text-sm text-[var(--ui-ux-5)] sm:grid-cols-2">
            <div>
              <p class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Edge</p>
              <p>{{ latestRecommendation.explanation.technical.edge | number : '1.3-3' }}</p>
            </div>
            <div>
              <p class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">EV</p>
              <p>{{ latestRecommendation.explanation.technical.ev | number : '1.3-3' }}</p>
            </div>
            <div>
              <p class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Stake</p>
              <p>{{ latestRecommendation.recommendation.stake_amount | number : '1.2-2' }}</p>
            </div>
            <div>
              <p class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Variant</p>
              <p>{{ latestRecommendation.recommendation.recommended_market_variant }}</p>
            </div>
          </div>
          <div class="mt-4">
            <p class="text-xs uppercase tracking-wide text-[var(--ui-ux-1)]">Factores</p>
            <ul class="mt-2 space-y-2 text-sm text-[var(--ui-ux-5)]">
              <li *ngFor="let factor of latestRecommendation.explanation.factors">
                <span class="font-semibold">{{ factor.label }}:</span> {{ factor.detail }}
              </li>
            </ul>
          </div>
        </div>
      </section>
    </div>
  </main>

  <aside
    class="fixed right-0 top-16 h-[calc(100vh-4rem)] border-l border-[color:var(--ui-ux-1)] border-opacity-20 bg-[var(--ui-ux-4)] transition-all duration-300"
    [ngClass]="isSidebarOpen ? 'w-12 sm:w-72' : 'w-12'"
  >
    <div class="p-4 text-sm text-[var(--ui-ux-1)]" [ngClass]="isSidebarOpen ? 'hidden sm:block' : 'hidden'"></div>
  </aside>
</div>
